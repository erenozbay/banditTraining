import numpy as np
from supportingMethods import *

# algs = {'No correction': {}, 'Correction': {}}
# results = {}
# for keys in algs.keys():
#     results[keys] = {}
#     results[keys]['reward'] = np.zeros(5)
#     results[keys]['stError'] = np.zeros(5)
# results['No correction']['reward'] = np.array([10063.5 , 10441.75, 10497.6 , 10521.25, 10554.95])
# results['No correction']['stError'] = np.array([15.9334083 , 10.23194141, 14.82802752, 14.53159059, 11.65661722])
# results['Correction']['reward'] = np.array([8096.55, 8911.35, 9249.1 , 9412.75, 9285.95])
# results['Correction']['stError'] = np.array([22.20338319, 20.34068644, 23.31676221, 22.27282256, 24.03787064])
# plot_market_mBased(algs, 5, 20, 200, results, 100, 10, 3, True, True)
# exit()

# for m_cohort = 5, K = 20, T = 200
# algs = {'No correction': {}, 'Correction': {}}
# colors = ['red', 'navy', 'mediumseagreen', 'magenta', 'purple', 'blue']
# labels = list(algs.keys())
# counter = 0
# plt.figure(figsize=(7, 5), dpi=100)
# plt.rc('axes', axisbelow=True)
# plt.grid()
# results = {}
# for keys in algs.keys():
#     results[keys] = {}
#     results[keys]['reward'] = np.zeros(5)
# T: 2000, 4000, ..., 20000
# arr = np.arange(1, 11) * 2000
# results['No correction']['reward'] = np.array([0.193, 0.2795, 0.271, 0.9905, 1.803, 2.385, 3.287, 4.088, 4.1325, 3.585])
# results['Correction']['reward'] = np.array([0.172, 0.1795, 0.185, 0.2035, 0.185, 0.2035, 0.185, 0.2035, 0.1665, 0.185])
# T: 4000, 8000, ..., 20000
# arr = np.arange(1, 6) * 4000
# results['No correction']['reward'] = np.array([0.23625, 0.63075, 2.094, 3.6875, 3.85875])
# results['Correction']['reward'] = np.array([0.17575, 0.19425, 0.19425, 0.19425, 0.17575])
# T: 1000, 2000, ..., 20000
# arr = np.arange(1, 21) #* 1000
# results['No correction']['reward'] = np.array([0.164, 0.222, 0.298, 0.261, 0.279, 0.263, 0.749, 1.232, 1.68, 1.926,
#                                                1.973, 2.797, 2.961, 3.613, 3.963, 4.213, 4.287, 3.978, 3.617, 3.553])
# results['Correction']['reward'] = np.array([0.148, 0.196, 0.174, 0.185, 0.185, 0.185, 0.222, 0.185, 0.185, 0.185,
#                                             0.185, 0.222, 0.185, 0.185, 0.216, 0.191, 0.148, 0.185, 0.185, 0.185])
# for keys in algs.keys():
#     plt.plot(arr.astype('str'), results[keys]['reward'], color=colors[counter], label=labels[counter], marker='o',
#              markersize=3)
#     counter += 1
# plt.ylabel('Active Cohorts', fontsize=13)
# plt.xlabel('Time', fontsize=13)
# title = 'marketSim/activeCohorts.eps'
# plt.legend(loc="upper left")
# plt.savefig(title, format='eps', bbox_inches='tight')
# exit()


_ = None
params_ = {'numOpt': 1, 'alpha': 0, 'totalSim': 50, 'numArmDists': 50, 'c': 4, 'delta': 0, 'm': 1,
           'Switch': 'no', 'NADA': 'no'}
ADAETC_ = {'regret': [106.2216, 165.4292 ,226.1592, 264.8548,
311.9076 ,344.1032, 388.3564,421.2,
453.3956 ,492.7364],
           'standardError': [1.80751337, 2.86525309, 3.86734538, 4.70186376 ,5.15582829,5.60920453, 7.69002027 ,6.84203927, 9.32652529, 6.81546917],
           'cumReg': [39.18 ,   58.3364 , 84.6028 , 94.4412,
112.4764 ,120.0512 ,137.9924, 148.3908, 156.1212 ,173.434],
           'standardError_cumReg': [1.72455666, 2.64040662, 3.72519263,
4.27413252, 4.77943052, 5.33168483, 7.08071626, 6.40693852, 8.96722898, 6.71009931]}


naiveUCB1_ = {'regret': [463.062,   845.2336, 1190.9972, 1548.3808, 1862.4932, 2175.6216, 2504.0184,
2833.7976 ,3130.92  , 3447.1296],
           'standardError': [2.64217058 , 3.8008337 ,  6.05756558 , 6.65743146 , 8.91129453 , 9.94269396,
11.8114795,  14.89448772, 14.98939275 ,17.94077694],
           'cumReg': [57.9212 , 84.8968, 102.118 , 118.874 , 133.3896, 143.8764, 157.46 ,  167.1568,
177.0788, 192.4976],
           'standardError_cumReg': [0.6684883,  1.054847 ,  1.10001589, 1.26462064, 1.44398174 ,1.80701599,
1.83424256, 1.9701037,  2.12748373, 2.18817262]}



TS = {'regret': [158.7252 ,272.846 , 377.652 , 481.4392,
562.2912, 672.7588 ,762.2116, 858.5032, 934.1072 , 1044.7212],
           'standardError': [3.66455689 , 4.06153115 , 6.97285266,
8.27018924 , 11.02026969, 12.88247287,
11.80161432 ,16.63171256 ,17.54814778 ,24.16399333],
           'cumReg': [21.0944 ,28.1644 ,33.1996 , 37.3392,
43.8232, 46.5088, 52.16 ,  53.9064 ,57.858, 59.3684],
           'standardError_cumReg': [0.80722835 , 1.05387973 ,1.2217753,
1.35071133 ,1.91220922, 1.62777514,
1.84135993 , 2.40475452, 1.92861237, 2.66048748]}

BAI_ETC = {'regret': [414.7868  ,759.6912 ,1061.7624,
1374.8176 ,1660.5168 , 1958.6036, 2230.3876,
2514.0276 ,2815.508 ,3062.2936],
           'standardError': [2.73398713 , 5.78280016 ,  8.64533816,
11.16795315,  9.08824157 ,16.23198425,
19.64800449, 13.27106339 ,20.21784437, 24.65986965],
           'cumReg': [51.838 ,  74.3724 , 91.1344 ,  105.4552,
116.1392 , 129.6028 , 139.1632 , 150.6468, 161.0628, 169.062],
           'standardError_cumReg': [0.63019495,  0.88501551, 1.24706568,
1.62976117,  1.57622709, 1.90432006,
2.16543556, 2.18757785, 2.27256761, 2.14053184]}
plot_fixed_m(4, np.array([2]), np.arange(1, 11) * 4000, naiveUCB1_, TS, ADAETC_, _, _, _, _, _, params_, BAI_ETC)
plot_fixed_m(5, np.array([2]), np.arange(1, 11) * 4000, naiveUCB1_, TS, ADAETC_, _, _, _, _, _, params_, BAI_ETC)


_ = None
params_ = {'numOpt': 1, 'alpha': 0, 'totalSim': 50, 'numArmDists': 50, 'c': 4, 'delta': 0, 'm': 1,
           'Switch': 'no', 'NADA': 'no'}
ADAETC_ = {'regret': [97.5164, 151.4216, 194.9364, 236.412 , 272.4296, 302.5492, 338.1156, 368.3088,
395.8652, 415.9624],
           'standardError': [1.07559423 ,1.46838827 ,1.53084956 ,1.62199453 ,1.96503584, 1.92739494,
2.38879908, 2.3789014,  3.17494042 ,3.04434078],
           'cumReg': [26.114,  37.5064, 46.1892 ,55.238 , 61.8116 ,65.7916 ,74.2252 ,80.4696, 83.3824,
81.7276],
           'standardError_cumReg': [1.06373053, 1.34378932 ,1.5213265 , 1.55230494, 1.7607603  ,1.76695925,
2.31604303, 2.15025559 ,3.01808054 ,2.81061393]}
naiveUCB1_ = {'regret': [819.8396, 1636.012 , 2447.6812, 3258.632 , 4052.112 , 4874.5868, 5670.6336,
6459.3328 ,7265.3072 ,8069.9596],
              'standardError': [3.20425674 , 6.01312399 , 7.92730399 ,12.38184082 ,13.23074353 ,14.75888744,
19.19600079, 23.97872198 ,23.54381087, 28.25781248],
              'cumReg': [26.9524, 36.3328, 47.1584, 50.6404, 56.8636, 64.7548, 69.6132, 73.5052 ,77.9372,
79.0932],
              'standardError_cumReg': [0.73232712, 0.88416193 ,1.18843074, 1.43803004 ,1.50036824, 1.54712945,
1.59921047, 2.02072081, 2.07681441 ,2.32668359]}

BAI_ETC = {'regret': [834.0208 ,1627.1156, 2461.3596, 3256.86 ,  4069.2488, 4864.5528 ,5703.3144,
6454.8412, 7344.234 , 8108.0912],
      'standardError': [3.7035998,   6.27304025 ,10.55710849, 13.29890314, 16.47365265, 26.8346309,
20.63102387 ,28.79485515, 30.25749889 ,31.40073152],
      'cumReg': [26.79 ,  35.9132, 46.7516, 52.8188, 60.8248, 63.9256, 70.492,  78.0236, 80.3424,
84.92],
      'standardError_cumReg': [0.67708889 ,0.95783065 ,1.06015049, 1.47891392, 1.37720535, 1.50574548,
1.44731553 ,1.74474688, 1.84977937, 2.15997496]}

TS = {'regret': [470.8328,  927.4832 ,1392.3784 ,1854.382 , 2361.9224, 2791.6456, 3156.176,
3593.1492, 4206.51 ,  4625.9212],
           'standardError': [5.66695595 ,11.36099638, 15.17637434, 24.14649594, 27.99723975, 31.50112148,
37.88810656, 47.43666132, 50.51807718, 70.90713375],
           'cumReg': [19.7404, 30.2608, 37.3056 ,41.484 , 47.7572 ,54.9268, 56.1792 ,62.7132 ,66.9092,
66.3852],
           'standardError_cumReg': [0.70153032 ,1.02419326 ,1.24305341 ,1.51641651, 1.5811615 , 1.89170185,
1.8662816  ,2.12419514, 2.06790686 ,1.7672544 ]}
plot_fixed_m(4, np.array([2]), np.arange(1, 11) * 4000, naiveUCB1_, TS, ADAETC_, _, _, _, _, _, params_,
             BAI_ETC)
plot_fixed_m(5, np.array([2]), np.arange(1, 11) * 4000, naiveUCB1_, TS, ADAETC_, _, _, _, _, _, params_,
             BAI_ETC)

### plots
_ = None
K_list = np.array([2])
T_list = np.arange(1, 16) * 1000
params_ = {'numOpt': 1, 'alpha': 0, 'totalSim': 100, 'numArmDists': 250, 'c': 4, 'delta': 0, 'm': 1,
           'Switch': 'no'}
ADAETC_ = {'regret': [26.8037232, 33.44507723, 43.50046911, 45.10047318, 57.1204632, 55.37838916, 65.00169276,
                      69.39592924, 74.40442152, 69.4653679, 83.85782629, 78.11440985, 88.50950931, 84.82735255,
                      87.18839996],
           'standardError': [0.92278586, 1.2346894, 1.83587324, 1.99937277, 2.56684265, 2.67792064,
                             3.11918679, 3.65190925, 3.80024214, 3.48524324, 4.49293148, 4.23062444,
                             5.11763915, 4.65193228, 5.07901265]}
ETC_ = {'regret': [42.9795232, 69.85735723, 91.94206911, 108.53563318, 131.3070232,
                   143.36654916, 160.59165276, 173.49896924, 190.00782152, 196.8732079,
                   206.48134629, 222.57840985, 237.81174931, 249.06431255, 258.03127996],
        'standardError': [0.97634804, 1.42824374, 1.91190119, 2.34718774, 2.49025746, 3.06110312,
                          3.23102363, 3.71014002, 3.79655545, 4.09356194, 4.86685831, 4.89329218,
                          5.28261671, 5.05269203, 6.01428141]}
NADAETC_ = {'regret': [41.1448432, 63.63887723, 80.00022911, 90.59579318, 106.2102232,
                       111.58030916, 127.89881276, 137.12572924, 144.94550152, 140.9242079,
                       156.74622629, 160.52964985, 169.75330931, 173.17055255, 182.86187996],
            'standardError': [0.92410168, 1.35054562, 1.92528933, 2.31390939, 2.66135955, 3.17184934,
                              3.51717939, 4.21546905, 4.2179283, 4.32825905, 5.17717659, 5.23373061,
                              5.91481137, 5.7488579, 6.41058042]}
UCB1_stopping_ = {
    'regret': [41.1632432, 63.64263723, 80.01630911, 90.47555318, 105.5480632, 111.74402916, 128.01433276,
               137.23684924, 144.18014152, 140.9373279, 155.86494629, 160.25444985, 169.13266931,
               173.86719255, 182.46391996],
    'standardError': [0.92020676, 1.3586612, 1.93427622, 2.32327293, 2.66849583, 3.12738024, 3.56647396,
                      4.20222404, 4.25472493, 4.37930785, 5.16894814, 5.17352223, 5.85972487, 5.76336477,
                      6.43846717]}
SuccElim_ = {'regret': [42.7609632, 68.58419723, 87.60146911, 101.51651318, 118.2227032,
                        127.68318916, 143.77849276, 151.80748924, 165.86826152, 159.3431679,
                        173.68014629, 182.36892985, 190.57458931, 198.01915255, 208.11615996],
             'standardError': [0.96550269, 1.3978518, 1.85854844, 2.2782777, 2.44918981, 2.99361082,
                               3.36623452, 3.87447499, 3.95672141, 4.04610312, 4.84178548, 5.00822605,
                               5.64268555, 5.37960248, 6.21821305]}
for i in range(1, 2):
    plot_fixed_m(i, K_list, T_list, _, ADAETC_, ETC_,
                 NADAETC_, UCB1_stopping_, SuccElim_, _, params_)

# alpha 0.4
params_ = {'numOpt': 1, 'alpha': 0.4, 'totalSim': 100, 'numArmDists': 250, 'c': 4, 'delta': 0, 'm': 1,
           'Switch': 'no'}
ADAETC_ = {'regret': [38.73604998, 60.78534215, 76.62593865, 91.79332878, 101.20476967,
                      112.54656458, 123.11224074, 135.88825491, 144.84846409, 154.31550702,
                      157.73783088, 170.05846903, 182.69425039, 189.43844988, 193.95849543],
           'standardError': [0.37892226, 0.62204727, 0.83054986, 1.1985267, 1.41130222, 1.5594478,
                             1.89392792, 2.09519289, 2.29140476, 2.49911505, 2.8135394, 3.09023649,
                             3.27366191, 3.43980388, 3.33733003]}
ETC_ = {'regret': [42.14180998, 67.09714215, 86.63773865, 103.54672878, 119.03944967,
                   133.47812458, 147.32700074, 160.68009491, 175.35954409, 185.97130702,
                   197.64559088, 208.68994903, 222.92441039, 233.87944988, 238.79821543],
        'standardError': [0.3965223, 0.5735214, 0.69590913, 0.86200728, 1.09389293, 1.08981349,
                          1.29275083, 1.39622428, 1.40435338, 1.60521799, 1.70410731, 1.82244676,
                          1.86466615, 2.04862906, 2.14104112]}
NADAETC_ = {'regret': [42.11920998, 66.99254215, 86.33685865, 103.93444878, 118.54104967,
                       133.47252458, 146.07748074, 161.10625491, 175.93622409, 188.17790702,
                       197.31091088, 208.81026903, 223.79789039, 234.91360988, 239.14677543],
            'standardError': [0.39134253, 0.56777756, 0.68510201, 0.85853425, 1.08333896, 1.02746662,
                              1.26498548, 1.46071451, 1.52447829, 1.6292776, 1.77681668, 1.80560368,
                              1.8918351, 2.04588577, 2.18009702]}
UCB1_stopping_ = {
    'regret': [42.26752998, 67.45478215, 86.48505865, 104.47568878, 119.09192967,
               133.00536458, 147.53028074, 160.34261491, 175.46534409, 187.00378702,
               195.60363088, 210.15926903, 222.77153039, 235.47160988, 239.69121543],
    'standardError': [0.40746235, 0.55436888, 0.70957949, 0.91049031, 1.02389755, 1.08103741,
                      1.30277614, 1.47640943, 1.50815156, 1.59026179, 1.63280718, 1.87538794,
                      2.039537, 2.09318265, 2.16889068]}
SuccElim_ = {'regret': [42.21564998, 67.51122215, 87.55925865, 104.38728878, 118.68000967,
                        133.77136458, 146.31488074, 161.01977491, 175.19074409, 187.69566702,
                        197.44439088, 207.48954903, 223.23881039, 234.82624988, 240.45905543],
             'standardError': [0.39577918, 0.56796057, 0.6923111, 0.93204667, 1.0622347, 1.0595299,
                               1.23784399, 1.42879689, 1.45305207, 1.58206878, 1.63589644, 1.80577838,
                               2.04134831, 2.08400056, 2.15263996]}
for i in range(1, 2):
    plot_fixed_m(i, K_list, T_list, _, ADAETC_, ETC_,
                 NADAETC_, UCB1_stopping_, SuccElim_, _, params_)

### plots
